<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>Ocean Impact</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<style>
  html,body{margin:0;padding:0;overflow:hidden;background:#000}
  canvas{display:block}
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
/* ================= 基础设置 ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* ================= 资源 ================= */
const mapImg = new Image();
mapImg.src = "ocean_map.png"; // ← 用你这张图，文件名保持一致

/* ================= 游戏状态 ================= */
const HEART_MAX = 3;
let hp = 3;
let healTimer = 0;

const keys = {};
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

/* ================= 实体 ================= */
const player = {
  x: 700, y: 420, r: 14,
  speed: 3,
  onBoat: false
};

const boat = {
  x: 660, y: 450, r: 18,
  speed: 3
};

/* 示例物体（真实项目你可以继续加） */
let bottles = [{x:300,y:500,r:12}];
let rocks   = [{x:900,y:300,r:16}];
let green   = [{x:1000,y:500,r:14}];
let dolphins= [{x:850,y:520,r:14}];
let netBoats= [{x:200,y:200,r:16}];

/* ================= 工具 ================= */
function dist(a,b){return Math.hypot(a.x-b.x,a.y-b.y);}
function hit(a,b){return dist(a,b)<a.r+b.r;}
function loseHP(v){ hp=Math.max(0,hp-v); }

/* ================= 区域判断（简化版） =================
   说明：
   - 水域/陆地/山体 在正式版本可用像素取色或遮罩图
   - 这里用大致规则保证可运行
*/
function isWater(x,y){
  return y < canvas.height*0.65;
}
function isLand(x,y){
  return !isWater(x,y);
}

/* ================= 主循环 ================= */
let last=performance.now();
function loop(t){
  const dt=(t-last)/1000; last=t;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  /* 背景 */
  if(mapImg.complete){
    ctx.drawImage(mapImg,0,0,canvas.width,canvas.height);
  }

  /* 移动逻辑 */
  let dx=0,dy=0;
  if(keys["ArrowUp"])dy=-1;
  if(keys["ArrowDown"])dy=1;
  if(keys["ArrowLeft"])dx=-1;
  if(keys["ArrowRight"])dx=1;

  if(player.onBoat){
    boat.x+=dx*boat.speed;
    boat.y+=dy*boat.speed;
    player.x=boat.x;
    player.y=boat.y;
  }else{
    const nx=player.x+dx*player.speed;
    const ny=player.y+dy*player.speed;
    if(isLand(nx,ny)){
      player.x=nx; player.y=ny;
    }
    if(hit(player,boat)) player.onBoat=true;
  }

  if(player.onBoat && !isWater(boat.x,boat.y)){
    player.onBoat=false;
  }

  /* 碰撞 */
  bottles=bottles.filter(o=>{
    if(player.onBoat && hit(boat,o)){return false;}
    return true;
  });

  rocks.forEach(o=>{
    if(player.onBoat && hit(boat,o)) loseHP(1);
  });

  green=green.filter(o=>{
    if(player.onBoat && hit(boat,o)){loseHP(0.5);return false;}
    return true;
  });

  dolphins=dolphins.filter(o=>{
    if(player.onBoat && hit(boat,o)){loseHP(0.5);return false;}
    return true;
  });

  netBoats=netBoats.filter(o=>{
    if(player.onBoat && hit(boat,o)){loseHP(0.5);return false;}
    return true;
  });

  /* 自动回血 */
  healTimer+=dt;
  if(healTimer>=10){
    healTimer=0;
    hp=Math.min(HEART_MAX,hp+0.5);
  }

  /* 绘制玩家/船 */
  ctx.fillStyle="yellow";
  ctx.beginPath();ctx.arc(player.x,player.y,player.r,0,Math.PI*2);ctx.fill();
  ctx.fillStyle="brown";
  ctx.beginPath();ctx.arc(boat.x,boat.y,boat.r,0,Math.PI*2);ctx.fill();

  /* UI */
  ctx.fillStyle="white";
  ctx.font="20px sans-serif";
  ctx.fillText("❤️ "+hp.toFixed(1),20,30);

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>